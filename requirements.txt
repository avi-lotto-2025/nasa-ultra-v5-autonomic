# ============================================
# NASA_ULTRA_KIRA_AUTONOMIC_FINAL_V3.2.py
# Quantum-Aware Autonomous Lotto Prediction System
# ============================================

import numpy as np
import random
import datetime
import time
import json
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

# =====================================================
# âš™ï¸ ×”×’×“×¨×•×ª ××¢×¨×›×ª ×‘×¡×™×¡×™×•×ª
# =====================================================

VERSION = "NASA_ULTRA_KIRA_AUTONOMIC_FINAL_V3.2"
MAIN_DRAW = (6, 37)   # 6 ××ª×•×š 37
BONUS_DRAW = (1, 7)   # ×‘×•× ×•×¡ ××—×“ ××ª×•×š 7
DAILY_TRAIN_HOUR = 2  # 02:00
RUN_HOURS = [20]      # ×©×œ×™×©×™ / ×—××™×©×™ / ×©×‘×ª 20:00

EMAIL_USER = "avi5588@gmail.com"
EMAIL_PASS = "placeholder_password"  # × ×—×œ×™×£ ××—"×› ×‘××©×ª× ×” ×¡×‘×™×‘×”
RECIPIENT = "avi5588@gmail.com"

# =====================================================
# ğŸ§© ×©×›×‘×ª ×¨×“×™× ×¡×§×™ (Kira Layer): ×—×™×–×•×™ ×œ×¤×™ ×“×¤×•×¡×™ ×–××Ÿ
# =====================================================

def kira_time_pattern_layer(history):
    """
    × ×™×ª×•×— ×œ×¤×™ ×ª×“×™×¨×•×ª, ××¨×•×•×—×™ ×–××Ÿ, ×•×¡×˜×™×•×ª ×ª×§×Ÿ.
    ××—×§×” ××ª ×”×’×™×©×” ×©×œ ×§×™×¨×” ×¨×“×™× ×¡×§×™ â€“ ×—×™×–×•×™ ×œ×¤×™ ×”×§×©×¨×™× ×”×¡×ª×‘×¨×•×ª×™×™× ×‘×–××Ÿ.
    """
    all_numbers = [num for draw in history for num in draw['main']]
    freq = {i: all_numbers.count(i) for i in range(1, MAIN_DRAW[1]+1)}
    avg = np.mean(list(freq.values()))
    std = np.std(list(freq.values()))

    # ××©×§×œ ×™×ª×¨ ×œ××¡×¤×¨×™× ×©×”×•×¤×™×¢×• ×‘×ª×“×™×¨×•×ª ×§×¨×•×‘×” ×œ×××•×¦×¢ + ×¡×˜×™×™×” ×§×˜× ×”
    weights = {n: 1 / (abs(freq[n] - avg) + std + 0.1) for n in freq}
    return weights

# =====================================================
# ğŸŒŒ ×©×›×‘×ª × ××¡"×-×¢×œ: ×©×›×‘×ª ×”×¡×ª×‘×¨×•×ª ×—×›××”
# =====================================================

def nasa_ultra_layer(weights):
    """
    ×‘×•× ×” ×©×›×‘×ª ×”×¡×ª×‘×¨×•×ª ×”×¡×ª×’×œ×•×ª×™×ª ×œ×¤×™ ××©×§×œ×™× ×“×™× ××™×™×.
    """
    numbers = list(weights.keys())
    probs = np.array(list(weights.values()))
    probs = probs / np.sum(probs)
    chosen = np.random.choice(numbers, size=MAIN_DRAW[0], replace=False, p=probs)
    return sorted(chosen)

# =====================================================
# ğŸ² ×©×›×‘×ª Monte Carlo
# =====================================================

def monte_carlo_layer(weights, iterations=40000):
    results = []
    numbers = list(weights.keys())
    probs = np.array(list(weights.values()))
    probs = probs / np.sum(probs)

    for _ in range(iterations):
        draw = tuple(sorted(np.random.choice(numbers, size=MAIN_DRAW[0], replace=False, p=probs)))
        results.append(draw)

    # ×¡×¤×™×¨×ª ×©×›×™×—×•×ª
    unique, counts = np.unique(results, axis=0, return_counts=True)
    top = sorted(list(zip(unique, counts)), key=lambda x: x[1], reverse=True)[:5]
    return [list(x[0]) for x in top]

# =====================================================
# ğŸ§¬ ×©×›×‘×ª ×œ××™×“×” ×¢×¦××™×ª
# =====================================================

def self_learning_layer(history, new_prediction):
    """
    ××¢×“×›×Ÿ ××ª ×”×”×™×¡×˜×•×¨×™×” ×‘××•×¤×Ÿ ×”×¡×ª×’×œ×•×ª×™.
    """
    timestamp = datetime.datetime.now().isoformat()
    history.append({
        "timestamp": timestamp,
        "main": new_prediction,
        "bonus": random.randint(1, BONUS_DRAW[1])
    })
    return history[-200:]  # ×©×•××¨ ×¨×§ ××ª 200 ×”××—×¨×•× ×™×

# =====================================================
# ğŸ’Œ ×©×œ×™×—×ª ×ª×—×–×™×ª ×‘××™×™×œ
# =====================================================

def send_email(pred_main, pred_bonus, backups):
    subject = f"ğŸ¯ ×ª×—×–×™×ª ×œ×•×˜×• ××•×˜×•× ×•××™×ª â€“ ×’×¨×¡×” {VERSION}"
    body = f"""
    ğŸ§  ×ª×—×–×™×ª ×¨××©×™×ª: {pred_main} | ×‘×•× ×•×¡: {pred_bonus}
    ğŸ”„ ×¡×˜×™ ×’×™×‘×•×™:
    1ï¸âƒ£ {backups[0]}
    2ï¸âƒ£ {backups[1]}
    3ï¸âƒ£ {backups[2]}
    4ï¸âƒ£ {backups[3]}
    5ï¸âƒ£ {backups[4]}

    ×”×•×¤×§ ××•×˜×•××˜×™×ª ×¢×œ ×™×“×™ ×”××•×— ×”××•×˜×•× ×•××™ NASA-ULTRA-KIRA ğŸª
    """

    msg = MIMEMultipart()
    msg['From'] = EMAIL_USER
    msg['To'] = RECIPIENT
    msg['Subject'] = subject
    msg.attach(MIMEText(body, 'plain'))

    try:
        server = smtplib.SMTP('smtp.gmail.com', 587)
        server.starttls()
        server.login(EMAIL_USER, EMAIL_PASS)
        server.send_message(msg)
        server.quit()
        print("âœ… ××™×™×œ × ×©×œ×— ×‘×”×¦×œ×—×”.")
    except Exception as e:
        print("âš ï¸ ×©×’×™××” ×‘×©×œ×™×—×ª ×”××™×™×œ:", e)

# =====================================================
# ğŸ§© ×¤×•× ×§×¦×™×™×ª ×”×¨×¦×” ×›×•×œ×œ×ª
# =====================================================

def run_autonomic_cycle():
    print(f"\nğŸš€ ×”×¨×¦×” ××•×˜×•× ×•××™×ª â€“ ×’×¨×¡×” {VERSION}")
    # ×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×”
    try:
        with open("quantum_brain_state.json", "r", encoding="utf-8") as f:
            history = json.load(f)
    except FileNotFoundError:
        history = []

    # ×©×›×‘×•×ª
    weights = kira_time_pattern_layer(history)
    main_prediction = nasa_ultra_layer(weights)
    backups = monte_carlo_layer(weights)
    bonus = random.randint(1, BONUS_DRAW[1])

    # ×¢×“×›×•×Ÿ ×”××•×—
    updated_history = self_learning_layer(history, main_prediction)

    # ×©××™×¨×”
    with open("quantum_brain_state.json", "w", encoding="utf-8") as f:
        json.dump(updated_history, f, ensure_ascii=False, indent=2)

    # ×©×œ×™×—×”
    send_email(main_prediction, bonus, backups)

# =====================================================
# ğŸ•’ ×ª×–××•×Ÿ ×—×›× (××•×˜×•× ×•××™)
# =====================================================

def autonomic_scheduler():
    while True:
        now = datetime.datetime.now()
        if now.hour == DAILY_TRAIN_HOUR:
            print("ğŸ§  ×©×œ×‘ ××™××•×Ÿ ×¢×¦××™ ×™×•××™...")
            run_autonomic_cycle()

        if now.hour in RUN_HOURS and now.weekday() in [1, 3, 5]:
            print("ğŸ¯ ×”×¨×¦×” ×§×‘×•×¢×” ×œ×™×•× ×”×’×¨×œ×”...")
            run_autonomic_cycle()

        time.sleep(3600)  # ×‘×“×™×§×” ×›×œ ×©×¢×”

# =====================================================
# â–¶ï¸ ×”×¨×¦×” ×—×“ ×¤×¢××™×ª (×œ×‘×“×™×§×”)
# =====================================================

if __name__ == "__main__":
    print(f"ğŸ¤– ××¢×¨×›×ª {VERSION} ×”×•×¤×¢×œ×”.")
    run_autonomic_cycle()
numpy
smtplib
email×”